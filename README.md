![Status - Incubating](https://img.shields.io/static/v1?label=Status&message=Incubating&color=FEFF3A&style=for-the-badge)

# COVESA AOSP SDK

## Objective of this SDK
The main goal of this SDK is to provide a set of libraries which allow third-party applications to access some automotive features in a way that is agnostic of manufacturer and model.

Examples of such features include:
1. Car features such as control over interior ambient lights or car data such as mileage which are not exposed by OEMs via [CarPropertyManager](https://developer.android.com/reference/android/car/hardware/property/CarPropertyManager)
2. Common APIs for functions which are not supported by AOSP, such as the push notification API.

## Standardization
Standardization of different car APIs is an ongoing effort: https://wiki.covesa.global/display/WIK4/Automotive+AOSP+App+Framework+Standardization+Expert+Group

Push notifications is the first standardized API within this group.

This SDK also provides an example of an AIDL-based communication between an OEM-implementable service and a third-party application. The example implements an ambient light API.

## Versioning
The versioning strategy and stability promises are yet to be established.

## SDK components
The SDK puts into communication 3 components:
* **Client app**: the third party-app that wants to interact with manufacturers cars.
* **Server app**: the service that each manufacturer needs to implement on their cars.
* **AIDL**: it’s the interface used for remote communication between the client and server apps.

The AIDL definition for the SDK is contained in the [api/aidl](./api/aidl/) gradle module.
The official Google documentation about the AIDL format can be found [here](https://developer.android.com/develop/background-work/services/aidl).

While client apps developers can directly use the AIDL to establish a connection with the SDK service, an utility layer is defined in the [api/client](./api/client/) gradle module. This layer hides most of the complexity of the AIDL connection by exposing a modern, more developer-friendly interface.

The same layer is used to expose APIs which do not depend on AIDL, such as push notifications.

## Push notifications
Third-party apps should link to the same single library `implementation(project(":api:client"))`. See [samples/client](./samples/client) for details. 

There is no AIDL layer for push notifications. Instead of an AIDL-based system service, OEMs implement their own [distributor](https://unifiedpush.org/users/distributors/) which is reacting to a specific broadcast.

## API Artifacts
Both API libraries artifacts can be generated by using the following commands:

```
./gradlew :api:aidl:assemble
./gradlew :api:client:assemble
```

The generated `aar` library files can then be found in the `build/output/aar` folders for each module.

## Integration with third-party apps
The generated `aar` libraries can be added as dependency for a third-party app by copying them in a folder in the app project tree and adding the following in the app module `build.gradle.kts`:

```
dependencies {
    implementation(files("../libs/aidl-debug.aar"))
    implementation(files("../libs/client-debug.aar"))
    ...
}
```

## Samples
Example implementations for both the client and server libraries integrations can be found in the [samples](./samples) modules of this repo.
Each sample contains its own README.md with more detailed information.

## Client testing
Third party app developers can test the library correct integration by installing the [server sample](./samples/server) in any Android emulator (even a non-automotive one) running a minimum Android SDK version as defined in the [library configuration](./gradle-plugins/src/main/kotlin/global/covesa/gradle/AndroidPlugin.kt#L11).

The server sample acts both as a reference for car manufacturers but also it logs every request received by client apps and responds updating each registered listener in a realistic way. That can be used to test third party apps behavior.

### Maintainers
* Juhani Lehtimäki - Snapp Automotive
* José Freitas - FORVIA
